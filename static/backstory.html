<!DOCTYPE html>
<html lang="en">
    <!-- Head has metadata about the page -->
    <head>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="styles.css">
        <title>Backstory Parser</title>
    </head>
    <!-- Body is the rendered content -->
    <body>
        <a href="index.html">Back to Ima</a>
        <h1>Parse your backstory</h1>
        <textarea id="backstory" placeholder="Paste your backstory here"></textarea>
        <button id="parse">Parse</button>
        <pre id = "result"></pre>
    </body>
    <script>
        const backstory = document.getElementById("backstory");
        backstory.addEventListener("keydown", async () => {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                document.getElementById("parse").click();
            }
        });

        document.getElementById("parse").addEventListener("click", async () => {
            const text = document.getElementById("backstory").value;
            if (!text) return;

            try {
                const response = await fetch('/parse-backstory', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        text: text
                    })
                });

                const data = await response.json();

                // Display formatted JSON
                let output = '';
                if (data.error) {
                    output = 'Error: ' + data.error;
                } else {
                    output = '=== PAST ===\n';
                    data.past?.forEach(item => output += `Age ${item.age}: ${item.event}\n`);

                    output += '\n=== PRESENT ===\n';
                    data.present?.forEach(item => output += `Age ${item.age}: ${item.event}\n`);

                    output += '\n=== FUTURE ===\n';
                    data.future?.forEach(item => output += `${item.event}\n`);

                    output += '\n=== THEMES ===\n';
                    data.themes?.forEach(theme => output += `- ${theme}\n`);

                    output += '\n=== PROJECTS ===\n';
                    data.projects?.forEach(project => output += `- ${project}\n`);

                    output += '\n\n=== RAW JSON ===\n' + JSON.stringify(data, null, 2);
                }

                document.getElementById('result').textContent = output;
            } catch (error) {
                document.getElementById('result').textContent = 'Error: ' + error.message;
            }
        });
    </script>
</html>